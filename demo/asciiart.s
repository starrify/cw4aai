.inc "../inc/jmp_fix.inc"
.inc "../inc/syscall.inc"
.inc "../lib/io.lib"
.inc "../lib/string.lib"

.def b param0 {
    beq $zero, $zero, param0
}

.def nop {
    sll $zero, $zero, 0
}

.def MSC_DATA_OFF {0}
.def MSC_DATA_SIZE {0x20000} #128k in bytes

.static {
MSC_FILENAME:
    .str "earth.dat"
ERRMSG:
    .str "cannot open file earth.dat\n"
NL:
    .str "\x5c"
    .str  "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x76\x6f\x7e\x5e\x27\x27\x3a\x26\x62\x3a\x3a\x64\x2c\x23\x62\x5c"
.str "\x5f\x0a"
.str "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x2e\x60\x22\x20\x60\x3a\x76\x20\x2b\x39\x50\x5d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x48\x6f\x5f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2c\x2d\x20\x20\x20\x20\x20\x3f\x4d\x62\x23\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x48\x6f\x2e\x0a\x20\x20\x20\x20\x20\x2e\x20\x22\x20\x20\x20\x20\x20\x2c\x6f\x6f\x4d\x2a\x26\x26\x26\x48\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x48\x62\x2e\x0a\x20\x20\x20\x20\x2e\x20\x20\x20\x2d\x20\x20\x20\x20\x39\x39\x53\x6f\x6f\x3f\x7c\x27\x60\x2a\x3f\x23\x23\x48\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x48\x5c\x0a\x20\x20\x20\x2d\x20\x20\x20\x20\x20\x20\x20\x2e\x48\x4d\x4d\x4d\x4d\x4d\x4d\x23\x6f\x64\x23\x62\x6f\x6f\x64\x4d\x4d\x4d\x4d\x48\x4d\x4d\x4d\x4d\x4d"
aaa0:
    .str "\x4d\x4d\x4d\x4d\x4d\x62\x0a\x20\x20\x2d\x20\x20\x20\x20\x20\x20\x3a\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x36\x37\x48\x4d\x4d\x48\x26\x24\x52\x2a\x2a\x48\x4d\x4d\x4d\x4d\x4d\x62\x0a\x20\x3a\x20\x20\x20\x20\x20\x20\x2e\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x2f\x48\x4d\x4d\x4d\x4d\x4d\x7c\x20\x20\x60\x39\x4d\x4d\x27\x48\x4c\x0a\x3a\x20\x20\x20\x20\x20\x20\x20\x7b\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x5c\x4d\x4d\x2a\x27\x27\x20\x20\x20\x20\x60\x48\x5b\x20\x60\x39\x7c\x0a\x7c\x20\x20\x20\x20\x20\x20\x20\x60\x48\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x62\x23\x23\x7c\x20\x20\x20\x20\x20\x20\x60\x46\x2e\x20\x3a\x3f\x0a\x48\x20"
aaa:
    .str "\x20\x20\x20\x20\x20\x20\x20\x60\x22\x2a\x22\x27\x22\x60\x23\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x3f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27\x20\x20\x6b\x0a\x4d\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x22\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x48\x0a\x4d\x4d\x48\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x60\x48\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x7c\x0a\x26\x4d\x4d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x60\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x2c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2d\x0a\x60\x4d\x4d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x64\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x7c\x2e\x6f\x48\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3a\x0a\x20\x39\x4d\x4c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x60\x48\x4d\x4d\x4d\x4d\x4d\x4d\x4d\x3f\x20\x20\x64\x48\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2d\x0a\x20\x20\x48\x69\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x7c\x4d\x4d\x4d\x4d\x4d\x4d\x50\x20\x20\x20\x22\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x27\x0a\x20\x20\x20\x54\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x60\x4d\x4d\x4d\x23\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2d\x0a\x20\x20\x20\x20\x60\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x60\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x60\x0a\x20\x20\x20\x20\x20\x60\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2d\x0a\x20\x20\x20\x20\x20\x20\x20\x60\x2e\x2e\x20\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x2e\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x2e\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2e\x2d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27\x2d\x2e\x20\x2f\x2f\x23\x23\x23\x23\x23\x23\x4d\x23\x62\x7e\x22\x22\x0a"
}

    lla $s0, STATIC_END
    addi $s0, $s0, MSC_DATA_OFF
    lla $a0, MSC_FILENAME
    or $a1, $zero, $s0
    li $a2, MSC_DATA_SIZE
    ori $k0, $zero, SC_READ
    syscall
    beq $v0, $zero, MAIN
    lla $a0, ERRMSG
    jal PUTS
    j EXIT

MAIN:
    lw $t0, 0($s0)  # max char width, unused
    lw $s1, 4($s0)  # line count
    lw $s2, 8($s0)  # frame count
    lw $s3, 12($s0) # frame duration

    addi $a0, $s0, 16
    #lla $a0, NL
    jal PUTS    # flush screen once
    nop
    li $k0, SC_GETXY
    syscall
    xori $zero, $zero, 0
    sw $v0, 0($zero)
    sw $v1, 0($zero)
    sub $s6, $v0, $s1   # starting x. and starting y is $v1
    add $s7, $zero, $v1

DRAW_FRAME_RESTART:
    li $s5, 0   # loop counter
    addi $s4, $s0, 16   # string base
DRAW_FRAME_LOOP:
    add $a0, $zero, $s6
    add $a1, $zero, $s7
    li $k0, SC_GOTOXY    # restore the original cursor position
    syscall 
    add $a0, $zero, $s4
    jal PUTS
    nop
    add $a0, $zero, $s3
    li $k0, SC_SLEEP    # well just let it sleep for a while..
    syscall
    addi $s5, $s5, 1
    bge $s5, $s2, DRAW_FRAME_RESTART
    nop
    add $a0, $zero, $s4
    jal STRLEN
    nop
    add $s4, $s4, $v0
    b DRAW_FRAME_LOOP
    nop

EXIT:
    ori $k0, $zero, SC_EXIT
    syscall

